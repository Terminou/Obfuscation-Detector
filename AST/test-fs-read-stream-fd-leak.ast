[{"type":"String","value":"'use strict'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'../common'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"assert"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'assert'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'fs'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"fixtures"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'../common/fixtures'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"_fsopen"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"open"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"_fsclose"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"close"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"loopCount"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"50"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"totalCheck"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"50"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"emptyTxt"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fixtures"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"("},{"type":"String","value":"'empty.txt'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"open"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":"++"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_fsopen"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"apply"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"close"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":"--"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_fsclose"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"apply"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"testLeak"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"endFn"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"callback"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"console"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`testing for leaks from fs.createReadStream().${"},{"type":"Identifier","value":"endFn"},{"type":"Template","value":"}()...`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"i"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"check"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"checkFunction"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":"!=="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"&&"},{"type":"Identifier","value":"check"},{"type":"Punctuator","value":"<"},{"type":"Identifier","value":"totalCheck"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"check"},{"type":"Punctuator","value":"++"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"checkFunction"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"100"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"assert"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"strictEqual"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":","},{"type":"Template","value":"`no leaked file descriptors using ${"},{"type":"Identifier","value":"endFn"},{"type":"Template","value":"}() (got ${"},{"type":"Identifier","value":"openCount"},{"type":"Template","value":"})`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"openCount"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"callback"},{"type":"Punctuator","value":"&&"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"callback"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"100"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"setInterval"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"s"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fs"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"createReadStream"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"emptyTxt"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"s"},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"endFn"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"i"},{"type":"Punctuator","value":"==="},{"type":"Identifier","value":"loopCount"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"clearTimeout"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"this"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"checkFunction"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"100"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"testLeak"},{"type":"Punctuator","value":"("},{"type":"String","value":"'close'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"testLeak"},{"type":"Punctuator","value":"("},{"type":"String","value":"'destroy'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"}]