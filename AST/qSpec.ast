[{"type":"String","value":"'use strict'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'q'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q_no_error"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"_argToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arg"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"arg"},{"type":"Punctuator","value":"==="},{"type":"String","value":"'object'"},{"type":"Punctuator","value":"&&"},{"type":"Punctuator","value":"!"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"isError"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arg"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"?"},{"type":"Identifier","value":"toJson"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arg"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":":"},{"type":"String","value":"''"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"arg"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"_argumentsToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"args"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"sliceArgs"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"args"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"map"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"_argToString"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"String","value":"','"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"funcName"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"args"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"logPrefix"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"funcName"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'('"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"_argumentsToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"args"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"+"},{"type":"String","value":"')'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logPrefix"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'->throw('"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"_argToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"+"},{"type":"String","value":"')'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"else"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"isUndefined"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logPrefix"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"else"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logPrefix"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'->'"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"_argToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":">="},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"="},{"type":"String","value":"'success'"},{"type":"Punctuator","value":"+"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"||"},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"?"},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":">="},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"="},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"+"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"||"},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"?"},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":">="},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"="},{"type":"String","value":"'progress'"},{"type":"Punctuator","value":"+"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"||"},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"?"},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":">="},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"="},{"type":"String","value":"'error'"},{"type":"Punctuator","value":"+"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":"||"},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"!"},{"type":"Identifier","value":"returnValDefined"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":","},{"type":"String","value":"'reject('"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"_argToString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"+"},{"type":"String","value":"')'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"else"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"_logInvocation"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"arguments"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnVal"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"throwReturnVal"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"String","value":"'; '"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"nextTick"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"logExceptions"},{"type":"Punctuator","value":":"},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"!"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Keyword","value":"throw"},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Nothing to be flushed!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"while"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"forEach"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"try"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"task"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"logExceptions"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"dump"},{"type":"Punctuator","value":"("},{"type":"String","value":"'exception in mockNextTick:'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"message"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"task"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"exceptionHandler"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":"==="},{"type":"String","value":"'undefined'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"else"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"beforeEach"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"qFactory"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"nextTick"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"exceptionHandler"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q_no_error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"qFactory"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"nextTick"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"exceptionHandler"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"afterEach"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'$Q'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reject2"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolveFn"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"rejectFn"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"==="},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"resolveFn"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"rejectFn"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"else"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"==="},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"resolveFn"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"rejectFn"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"afterEach"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"reject2"},{"type":"Punctuator","value":"="},{"type":"Null","value":"null"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a Promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"finally"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should support the instanceof operator'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"promise"},{"type":"Keyword","value":"instanceof"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"promise"},{"type":"Keyword","value":"instanceof"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill the promise and execute all success callbacks in the registration order'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo; success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow deferred resolution with a new promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback in the next turn'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not break if a callbacks registers another callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'outer'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'inner'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'outer; inner'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not break if a callbacks tries to resolve the deferred again'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"val"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then1('"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"val"},{"type":"Punctuator","value":"+"},{"type":"String","value":"')->resolve(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then1(foo)->resolve(bar); success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject the promise and execute all error callbacks in the registration order'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo); error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not defer rejection with a new promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error({})->reject({})'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the error callback in the next turn'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should support non-bound execution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(detached)->reject(detached)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a success callback without an errback or progressBack '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a success callback without an errback and reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of an errback without a success or progress callback and '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of an errback without a success callback and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a progressBack without a success callback and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a progressBack without a error callback and reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve all callbacks with the original value'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'aVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bErr'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'D'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'dReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'E'"},{"type":"Punctuator","value":","},{"type":"String","value":"'eVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yup'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'successA(yup)->aVal'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successB(yup)->throw(bErr)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successC(yup)->{}'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successD(yup)->throw({})'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successE(yup)->eVal'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject all callbacks with the original reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'aVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bEr'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'D'"},{"type":"Punctuator","value":","},{"type":"String","value":"'dVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'noo!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'errorA(noo!)->aVal; errorB(noo!)->throw(bEr); errorC(noo!)->{}; errorD(noo!)->dVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should propagate resolution and rejection between dependent promises'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'x'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'1'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":","},{"type":"String","value":"'y'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'2'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":","},{"type":"String","value":"'z'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"5"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"5"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sweet!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success1(sweet!)->x'"},{"type":"Punctuator","value":","},{"type":"String","value":"'success2(x)->throw(y)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'error3(y)->throw(z)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'error4(z)->done'"},{"type":"Punctuator","value":","},{"type":"String","value":"'success5(done)->done'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject a derived promise if an exception is thrown while resolving its parent'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(done!)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject a derived promise if an exception is thrown while rejecting its parent'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'timeout'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(timeout)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call success callback in the next turn even if promise is already resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success(done!)->done!'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call error callback in the next turn even if promise is already rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should forward success resolution when success callbacks are not functions'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yay!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"String","value":"'gah!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success(yay!)->yay!'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should forward error resolution when error callbacks are not functions'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"String","value":"'gah!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not take an argument'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the promise is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo; finally1()'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original value'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'b'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bb'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'RESOLVED_VAL'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'finallyB()->b'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successBB(RESOLVED_VAL)->bb'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original value (larger test)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'a'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'b'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bb'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"String","value":"'c'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'IGNORED'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'cc'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCC'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCCC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'ccc'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCCC'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'RESOLVED_VAL'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'successA(RESOLVED_VAL)->a'"},{"type":"Punctuator","value":","},{"type":"String","value":"'finallyB()->b'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successC(RESOLVED_VAL)->c'"},{"type":"Punctuator","value":","},{"type":"String","value":"'finallyCC()->IGNORED'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successBB(RESOLVED_VAL)->bb'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successCCC(c)->cc'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successCCCC(cc)->ccc'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback returns a promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original reason after that promise resolves'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new rejection reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject2"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error1(bar)->reject(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback throws an exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'exception'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->throw(exception); error2(exception)->reject(exception)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the promise is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1(); error1(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the original reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'original'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1(); error2(original)->reject(original)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback returns a promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the original reason after that promise resolves'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve2"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'original'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error2(original)->reject(original)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the new reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject2"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"promise2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error1(bar)->reject(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback throws an exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'exception'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->throw(exception); error2(exception)->reject(exception)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should be a shorthand for defining promise error handlers'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createPromise"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo); error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'defer'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should create a new deferred'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeDefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeDefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeDefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill the promise and execute all success callbacks in the registration order'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo; success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should complain if promise fulfilled with itself'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"resolveSpy"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jasmine"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"createSpy"},{"type":"Punctuator","value":"("},{"type":"String","value":"'resolve'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectSpy"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jasmine"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"createSpy"},{"type":"Punctuator","value":"("},{"type":"String","value":"'reject'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolveSpy"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"rejectSpy"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolveSpy"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toHaveBeenCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"rejectSpy"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toHaveBeenCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"rejectSpy"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"calls"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"argsFor"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqualMinErr"},{"type":"Punctuator","value":"("},{"type":"String","value":"'$q'"},{"type":"Punctuator","value":","},{"type":"String","value":"'qcycle'"},{"type":"Punctuator","value":","},{"type":"String","value":"'Expected promise to be resolved with value other than itself'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow deferred resolution with a new promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback in the next turn'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should support non-bound execution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"resolver"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolver"},{"type":"Punctuator","value":"("},{"type":"String","value":"'detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(detached)->detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not break if a callbacks registers another callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'outer'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'inner'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'outer; inner'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not break if a callbacks tries to resolve the deferred again'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"val"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then1('"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"val"},{"type":"Punctuator","value":"+"},{"type":"String","value":"')->resolve(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then1(foo)->resolve(bar); success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject the promise and execute all error callbacks in the registration order'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo); error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not defer rejection with a new promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error({})->reject({})'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the error callback in the next turn'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should support non-bound execution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejector"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"rejector"},{"type":"Punctuator","value":"("},{"type":"String","value":"'detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(detached)->reject(detached)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'notify'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should execute all progress callbacks in the registration order'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress1(foo)->foo; progress2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if a promise was previously rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'qux'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not apply any special treatment to promises passed to notify'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress({})->{}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the progress callbacks in the next turn'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress1(foo)->foo; progress2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should ignore notifications sent out in the same turn before listener registration'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should support non-bound execution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(detached)->detached'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not save and re-emit progress notifications between ticks'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress1(foo)->foo; progress1(bar)->bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress1(baz)->baz; progress2(baz)->baz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should have a then method'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should have a catch method'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should have a finally method'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'then'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a success callback without an errback or progressBack '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a success callback without an errback and reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a success callback without a progressBack and notify'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'doing'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of an errback without a success or progress callback and '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of an errback without a success callback and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of an errback without a progress callback and notify'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'doing'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a progressBack without a success or error callback and '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'notify'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'doing'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(doing)->doing'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a progressBack without a success callback and resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should allow registration of a progressBack without a error callback and reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve all callbacks with the original value'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'aVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bErr'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'D'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'dReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'E'"},{"type":"Punctuator","value":","},{"type":"String","value":"'eVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'yup'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'successA(yup)->aVal'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successB(yup)->throw(bErr)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successC(yup)->{}'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successD(yup)->throw({})'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successE(yup)->eVal'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject all callbacks with the original reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'aVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bEr'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'D'"},{"type":"Punctuator","value":","},{"type":"String","value":"'dVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'noo!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'errorA(noo!)->aVal; errorB(noo!)->throw(bEr); errorC(noo!)->{}; errorD(noo!)->dVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should notify all callbacks with the original value'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'aVal'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bErr'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C_reject'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cRejectReason'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Z'"},{"type":"Punctuator","value":","},{"type":"String","value":"'the end!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'yup'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'progressA(yup)->aVal'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progressB(yup)->throw(bErr)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progressC(yup)->{}'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progressC_reject(yup)->throw({})'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progressZ(yup)->the end!'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should propagate resolution and rejection between dependent promises'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'x'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'1'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":","},{"type":"String","value":"'y'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'2'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":","},{"type":"String","value":"'z'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"5"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"5"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'sweet!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success1(sweet!)->x'"},{"type":"Punctuator","value":","},{"type":"String","value":"'success2(x)->throw(y)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'error3(y)->throw(z)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'error4(z)->done'"},{"type":"Punctuator","value":","},{"type":"String","value":"'success5(done)->done'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should propagate notification between dependent promises'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'a'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":","},{"type":"String","value":"'b'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":","},{"type":"String","value":"'c'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"5"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'wait'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'progress1(wait)->a'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progress2(a)->b'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progress3(b)->c'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progress4(c)->c'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progress5(c)->c'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject a derived promise if an exception is thrown while resolving its parent'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(done!)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject a derived promise if an exception is thrown while rejecting its parent'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'timeout'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(timeout)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should stop notification propagation in case of error'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":","},{"type":"String","value":"'ops!'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'wait'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'progress1(wait)->wait'"},{"type":"Punctuator","value":","},{"type":"String","value":"'progress2(wait)->throw(ops!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call success callback in the next turn even if promise is already resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success(done!)->done!'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call error callback in the next turn even if promise is already rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should forward success resolution when success callbacks are not functions'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yay!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"String","value":"'gah!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'success(yay!)->yay!'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should forward error resolution when error callbacks are not functions'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'oops!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"String","value":"'gah!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(oops!)->reject(oops!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not take an argument'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the promise is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(foo)->foo; finally1()'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original value'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'b'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bb'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'RESOLVED_VAL'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'finallyB()->b'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successBB(RESOLVED_VAL)->bb'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original value (larger test)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":","},{"type":"String","value":"'a'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'A'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":","},{"type":"String","value":"'b'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'B'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":","},{"type":"String","value":"'bb'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'BB'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":","},{"type":"String","value":"'c'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'C'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'IGNORED'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'cc'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCC'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCCC'"},{"type":"Punctuator","value":","},{"type":"String","value":"'ccc'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'CCCC'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'RESOLVED_VAL'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'successA(RESOLVED_VAL)->a'"},{"type":"Punctuator","value":","},{"type":"String","value":"'finallyB()->b'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successC(RESOLVED_VAL)->c'"},{"type":"Punctuator","value":","},{"type":"String","value":"'finallyCC()->IGNORED'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successBB(RESOLVED_VAL)->bb'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successCCC(c)->cc'"},{"type":"Punctuator","value":","},{"type":"String","value":"'successCCCC(cc)->ccc'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback returns a promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should fulfill with the original reason after that promise resolves'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; success2(foo)->foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new rejection reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error1(bar)->reject(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback throws an exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'exception'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->throw(exception); error2(exception)->reject(exception)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the promise is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1(); error1(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the original reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'original'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1(); error2(original)->reject(original)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback returns a promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is fulfilled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the original reason after that promise resolves'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'original'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error2(original)->reject(original)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'that is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with the new reason'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'bar'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"returnedDef"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->{}; error1(bar)->reject(bar)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when the callback throws an exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject with this new exception'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fin"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'exception'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'finally1()->throw(exception); error2(exception)->reject(exception)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should be a shorthand for defining promise error handlers'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(foo)->reject(foo); error2(foo)->reject(foo)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'reject'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should package a string into a rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'not gonna happen'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(not gonna happen)->reject(not gonna happen)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should package an exception into a rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'not gonna happen'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(Error: not gonna happen)->reject(Error: not gonna happen)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that forwards callbacks if the callbacks are missing'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'error(rejected)->reject(rejected)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should catch exceptions thrown in errback and forward them to derived promises'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Broken'"},{"type":"Punctuator","value":","},{"type":"String","value":"'catch me!'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Affected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'errorBroken(rejected)->throw(catch me!)'"},{"type":"Punctuator","value":","},{"type":"String","value":"'errorAffected(catch me!)->reject(catch me!)'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should have functions `finally` and `catch`'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'finally'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeUndefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"["},{"type":"String","value":"'catch'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeUndefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"rejectedPromise"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'resolution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the success callback in the next turn when the value is a non-promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hello)->hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the success callback in the next turn when the value is a resolved promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hello)->hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the errback in the next turn when the value is a rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'nope'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(nope)->reject(nope)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the success callback after the original promise is resolved'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hello)->hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the errback after the original promise is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'nope'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(nope)->reject(nope)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'notification'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call the progressBack when the value is a promise and gets notified'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'notification'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(notification)->notification'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'resolve'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should be an alias of the \"when\" function'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeDefined"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'optional callbacks'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not require success callback and propagate resolution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success2(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not require success callback and propagate rejection'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->reject(sorry); error2(sorry)->reject(sorry)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not require errback and propagate resolution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hi)->hello; success2(hello)->hello'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not require errback and propagate rejection'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error2(sorry)->reject(sorry)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not require progressBack and propagate notification'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'notification'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(notification)->notification'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'returned promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be resolved with a value returned from the success '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hello)->hi; success2(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be rejected with a rejected promise returned from the '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'success callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hello'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hello)->{}; error2(sorry)->reject(sorry)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be resolved with a value returned from the errback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->hi; success2(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be rejected with a rejected promise returned from the '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'errback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sigh'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->{}; error2(sigh)->reject(sigh)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be resolved with a promise returned from the success '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hi)->{}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'finally!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hi)->{}; success2(finally!)->finally!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should return a promise that can be resolved with promise returned from the errback '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'callback'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->{}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'finally!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->{}; success2(finally!)->finally!'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'security'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call success callback only once even if the original promise gets fulfilled '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'multiple times'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(done)->done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'evil is me'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'burn burn'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(done)->done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should call errback only once even if the original promise gets fulfilled multiple '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'times'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'failed'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(failed)->reject(failed)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'muhaha'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'take this'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(failed)->reject(failed)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not call progressBack after promise gets fulfilled, even if original promise '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'gets notified multiple times'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'notification'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'ok'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(notification)->notification; success(ok)->ok'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"String","value":"'muhaha'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress(notification)->notification; success(ok)->ok'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'all (array)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve all or nothing'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"r"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"r"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should take an array of promises and return a promise for an array of results'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success([\"hi\",\"hola\",\"cau\"])->[\"hi\",\"hola\",\"cau\"]'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject the derived promise if at least one of the promises in the array is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not forward notifications from individual promises to the combined promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'x'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"notify"},{"type":"Punctuator","value":"("},{"type":"String","value":"'y'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should ignore multiple resolutions of an (evil) array promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'first'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'muhaha'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'arghhh'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success([\"done\",\"first\"])->[\"done\",\"first\"]'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'all (hash)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve all or nothing'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"r"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"r"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should take a hash of promises and return a promise for a hash of results'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"en"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"fr"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"es"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'salut'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success({\"en\":\"hi\",\"es\":\"hola\",\"fr\":\"salut\"})->{\"en\":\"hi\",\"es\":\"hola\",\"fr\":\"salut\"}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject the derived promise if at least one of the promises in the hash is rejected'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"en"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"fr"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"es"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should ignore multiple resolutions of an (evil) hash promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"good"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"evil"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'first'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"String","value":"'muhaha'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"evilPromise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'arghhh'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success({\"evil\":\"first\",\"good\":\"done\"})->{\"evil\":\"first\",\"good\":\"done\"}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should handle correctly situation when given the same promise several times'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"all"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"first"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"second"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"third"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success({\"first\":\"done\",\"second\":\"done\",\"third\":\"done\"})->{\"first\":\"done\",\"second\":\"done\",\"third\":\"done\"}'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'race (array)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if given an empty array'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve as soon as the first promise is settled by resolution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject as soon as the first promise is settled by rejection'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'race (hash)'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should do nothing if given an empty object'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"queue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should resolve as soon as the first promise is settled by resolution'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"a"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"b"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"c"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(hi)->hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should reject as soon as the first promise is settled by rejection'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"race"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"a"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"b"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"c"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"''"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred1"},{"type":"Punctuator","value":","},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred2"},{"type":"Punctuator","value":","},{"type":"String","value":"'cau'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'hola'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error(hi)->reject(hi)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'exception logging'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"logger"},{"type":"Punctuator","value":":"},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"push"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"e"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"beforeEach"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"qFactory"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"nextTick"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"logger"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'in then'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions thrown in a success callback but reject the derived promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"success1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(done)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions when a success callback returns rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'done'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(done)->{}; error2(rejected)->reject(rejected)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions thrown in an errback but reject the derived promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"error1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'nope'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(nope)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions when an errback returns a rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncReject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'nope'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(nope)->{}; error2(rejected)->reject(rejected)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should log exceptions thrown in a progressBack and stop propagation, but should NOT reject '"},{"type":"Punctuator","value":"+"},{"type":"String","value":"'the promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'failed'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Null","value":"null"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progress"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncNotify"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'10%'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'progress1(10%)->throw(failed)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'failed'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"syncResolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"deferred"},{"type":"Punctuator","value":","},{"type":"String","value":"'ok'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success(ok)->ok'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'in when'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions thrown in a success callback but reject the derived promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"success1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hi)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions when a success callback returns rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"String","value":"'hi'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'success1(hi)->{}; error2(rejected)->reject(rejected)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions thrown in a errback but reject the derived promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"error1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"String","value":"'oops'"},{"type":"Punctuator","value":","},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->throw(oops); error2(oops)->reject(oops)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should NOT log exceptions when an errback returns a rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"when"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sorry'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rejected'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"success"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"error"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"logStr"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'error1(sorry)->{}; error2(rejected)->reject(rejected)'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"mockExceptionLogger"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"log"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'when exceptionHandler is called'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"CustomError"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"CustomError"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"prototype"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"Object"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"create"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"prototype"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"errorEg"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Fail'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"errorStr"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"toDebugString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"errorEg"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"customError"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"CustomError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Custom'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"customErrorStr"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"toDebugString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"customError"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"nonErrorObj"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"isATest"},{"type":"Punctuator","value":":"},{"type":"String","value":"'this is'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"nonErrorObjStr"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"toDebugString"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"nonErrorObj"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"fixtures"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":":"},{"type":"String","value":"'Error object'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"errorEg"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"errorEg"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"String","value":"'Possibly unhandled rejection: '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"errorStr"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":":"},{"type":"String","value":"'custom Error object'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"customError"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exception"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"customError"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"String","value":"'Possibly unhandled rejection: '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"customErrorStr"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":":"},{"type":"String","value":"'non-Error object'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"nonErrorObj"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"String","value":"'Possibly unhandled rejection: '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"nonErrorObjStr"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":":"},{"type":"String","value":"'string primitive'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":":"},{"type":"String","value":"'foo'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"reason"},{"type":"Punctuator","value":":"},{"type":"String","value":"'Possibly unhandled rejection: foo'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"forEach"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fixtures"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fixture"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fixture"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fixture"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"fixture"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'with '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"type"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should log an unhandled rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not log an unhandled rejected promise if disabled'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q_no_error"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should log a handled rejected promise on a promise without rejection callbacks'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"then"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"expected"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not log a handled rejected promise'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not log a handled rejected promise that is handled in a future tick'"},{"type":"Punctuator","value":","},{"type":"Keyword","value":"function"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"promise"},{"type":"Punctuator","value":"."},{"type":"Keyword","value":"catch"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"noop"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"defer"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"q"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"value"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"mockNextTick"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"flush"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exceptionHandlerCalls"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"}]