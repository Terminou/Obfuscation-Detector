[{"type":"Keyword","value":"import"},{"type":"Identifier","value":"sinon"},{"type":"Identifier","value":"from"},{"type":"String","value":"'sinon'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"import"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"from"},{"type":"String","value":"'sinon-express-mock'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"import"},{"type":"Identifier","value":"jwt"},{"type":"Identifier","value":"from"},{"type":"String","value":"'jsonwebtoken'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"import"},{"type":"Identifier","value":"createRequestAuthorization"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"isWhiteListedPath"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"from"},{"type":"String","value":"'./request-authorization'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":"="},{"type":"String","value":"'this is a super secret string'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"invalidJWTSecret"},{"type":"Punctuator","value":"="},{"type":"String","value":"'This is not correct secret'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"now"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Date"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"Date"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"now"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"theBeginningOfTime"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Date"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"id"},{"type":"Punctuator","value":":"},{"type":"String","value":"'123abc'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"userId"},{"type":"Punctuator","value":":"},{"type":"String","value":"'456def'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"ttl"},{"type":"Punctuator","value":":"},{"type":"Numeric","value":"60000"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"created"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"now"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"users"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"{"},{"type":"String","value":"'456def'"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"username"},{"type":"Punctuator","value":":"},{"type":"String","value":"'camperbot'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"progressTimestamps"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"["},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"mockGetUserById"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"id"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"id"},{"type":"Keyword","value":"in"},{"type":"Identifier","value":"users"},{"type":"Punctuator","value":"?"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"users"},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"id"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"reject"},{"type":"Punctuator","value":"("},{"type":"String","value":"'No user found'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'request-authorization'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'isWhiteListedPath'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"whiteList"},{"type":"Punctuator","value":"="},{"type":"Punctuator","value":"["},{"type":"RegularExpression","value":"/^\\/is-ok\\//","regex":{"pattern":"^\\/is-ok\\/","flags":""}},{"type":"Punctuator","value":","},{"type":"RegularExpression","value":"/^\\/this-is\\/also\\/ok\\//","regex":{"pattern":"^\\/this-is\\/also\\/ok\\/","flags":""}},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'returns a boolean'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"isWhiteListedPath"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'boolean'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'returns true for a white listed path'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"resultA"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"isWhiteListedPath"},{"type":"Punctuator","value":"("},{"type":"String","value":"'/is-ok/should-be/good'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"whiteList"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"resultB"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"isWhiteListedPath"},{"type":"Punctuator","value":"("},{"type":"String","value":"'/this-is/also/ok/surely'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"whiteList"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resultA"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resultB"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'returns false for a non-white-listed path'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"isWhiteListedPath"},{"type":"Punctuator","value":"("},{"type":"String","value":"'/hax0r-42/no-go'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"whiteList"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"result"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'createRequestAuthorization'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createRequestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwtSecret"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"getUserById"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"mockGetUserById"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'is a function'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Keyword","value":"typeof"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"String","value":"'function'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'cookies'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when no access token is present'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is required for this request'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when the access token is invalid'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"invalidJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"cookie"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwt_access_token"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is invalid'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when the access token has expired'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"..."},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"created"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"theBeginningOfTime"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"cookie"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwt_access_token"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is no longer vaild'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'adds the user to the request object'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"cookie"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwt_access_token"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toHaveProperty"},{"type":"Punctuator","value":"("},{"type":"String","value":"'user'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"user"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"users"},{"type":"Punctuator","value":"["},{"type":"String","value":"'456def'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'adds the jwt to the headers'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"cookie"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwt_access_token"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"set"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"calledWith"},{"type":"Punctuator","value":"("},{"type":"String","value":"'X-fcc-access-token'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'calls next if request does not require authorization'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/unauthenticated/another/route'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Auth header'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when no access token is present'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is required for this request'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when the access token is invalid'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"invalidJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"headers"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"String","value":"'X-fcc-access-token'"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is invalid'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'throws when the access token has expired'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Punctuator","value":"..."},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"created"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"theBeginningOfTime"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"headers"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"String","value":"'X-fcc-access-token'"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"invalidJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toThrowError"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Access token is no longer vaild'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'adds the user to the request object'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"assertions"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"headers"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"String","value":"'X-fcc-access-token'"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toHaveProperty"},{"type":"Punctuator","value":"("},{"type":"String","value":"'user'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"user"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toEqual"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"users"},{"type":"Punctuator","value":"["},{"type":"String","value":"'456def'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'adds the jwt to the headers'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jwt"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"sign"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"accessToken"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWTSecret"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/internal/some-path/that-needs/auth'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"cookie"},{"type":"Punctuator","value":":"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jwt_access_token"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"set"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"calledWith"},{"type":"Punctuator","value":"("},{"type":"String","value":"'X-fcc-access-token'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"validJWT"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"done"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'calls next if request does not require authorization'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"async"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockReq"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":":"},{"type":"String","value":"'/unauthenticated/another/route'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"mockRes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"sinon"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spy"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"await"},{"type":"Identifier","value":"requestAuthorization"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"req"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"res"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"next"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"called"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"}]