[{"type":"String","value":"'use strict'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'promise'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"mock"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"calls"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"length"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"do"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"runAllTimers"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"processNext"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"runAllTimers"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"while"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"hasTasksToProcess"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"describe"},{"type":"Punctuator","value":"("},{"type":"String","value":"'TaskQueue'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"onMoreTasks"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"expectedSequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"expectedSequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"beforeEach"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"resetModules"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"onMoreTasks"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"TaskQueue"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'TaskQueue'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"="},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"TaskQueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"onMoreTasks"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should run a basic task'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run1'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"hasTasksToProcess"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"processNext"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should handle blocking promise task'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"gen"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'gen1'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run2'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"processNext"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"onMoreTasks"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"hasTasksToProcess"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"onMoreTasks"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should handle nested simple tasks'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run3'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run1'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run2'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should handle nested promises'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"gen"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'gen2'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'resolve1'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"return"},{"type":"Keyword","value":"new"},{"type":"Identifier","value":"Promise"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"setTimeout"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"++"},{"type":"Identifier","value":"sequenceId"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run3'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"resolve"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'resolve2'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"gen"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'gen1'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"run"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"name"},{"type":"Punctuator","value":":"},{"type":"String","value":"'run4'"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should be able to cancel tasks'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"createSequenceTask"},{"type":"Punctuator","value":"("},{"type":"Numeric","value":"2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"cancelTasks"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task3"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task2"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expectToBeCalledOnce"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task4"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"hasTasksToProcess"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"it"},{"type":"Punctuator","value":"("},{"type":"String","value":"'should not crash when last task is cancelled'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"jest"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"fn"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"enqueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"cancelTasks"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"clearTaskQueue"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"task1"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"not"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBeCalled"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"expect"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"taskQueue"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"hasTasksToProcess"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"toBe"},{"type":"Punctuator","value":"("},{"type":"Boolean","value":"false"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"}]