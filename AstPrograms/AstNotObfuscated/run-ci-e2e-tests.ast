[{"type":"String","value":"'use strict'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'shelljs/global'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"spawn"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'child_process'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"spawn"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yargs'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'path'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"SCRIPTS"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"__dirname"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"ROOT"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"normalize"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"__dirname"},{"type":"Punctuator","value":","},{"type":"String","value":"'..'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"tryExecNTimes"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"require"},{"type":"Punctuator","value":"("},{"type":"String","value":"'./try-n-times'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"TEMP"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'mktemp -d /tmp/react-native-XXXXXXXX'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"stdout"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"trim"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"MARKER"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`mktemp ${"},{"type":"Identifier","value":"ROOT"},{"type":"Template","value":"}/template/XXXXXXXX`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"stdout"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"trim"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"numberOfRetries"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"retries"},{"type":"Punctuator","value":"||"},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"function"},{"type":"Identifier","value":"checkMarker"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"!"},{"type":"Identifier","value":"test"},{"type":"Punctuator","value":"("},{"type":"String","value":"'-e'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"basename"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"MARKER"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Marker was not found, react native init command failed?'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"try"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"CLI_PACKAGE"},{"type":"Punctuator","value":"="},{"type":"String","value":"'react-native-cli'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"!"},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"["},{"type":"String","value":"'skip-cli-install'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`yarn global add ${"},{"type":"Identifier","value":"CLI_PACKAGE"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Could not install react-native-cli globally.'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Run with --skip-cli-install to skip this step'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"android"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'./gradlew :ReactAndroid:installArchives -Pjobs=1 -Dorg.gradle.jvmargs=\"-Xmx512m -XX:+HeapDumpOnOutOfMemoryError\"'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to compile Android binaries'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yarn pack'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to pack react-native'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"PACKAGE"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"path"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"ROOT"},{"type":"Punctuator","value":","},{"type":"String","value":"'react-native-*.tgz'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"TEMP"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"tryExecNTimes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sleep 10s'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`react-native init EndToEndTest --version ${"},{"type":"Identifier","value":"PACKAGE"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"numberOfRetries"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"rm"},{"type":"Punctuator","value":"("},{"type":"String","value":"'-rf'"},{"type":"Punctuator","value":","},{"type":"String","value":"'EndToEndTest'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to execute react-native init'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Most common reason is npm registry connectivity, try again'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"String","value":"'EndToEndTest'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"android"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Running an Android end-to-end test'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"checkMarker"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Installing end-to-end framework'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"tryExecNTimes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yarn add --dev appium@1.11.1 mocha@2.4.5 wd@1.11.1 colors@1.0.3 pretty-data2@0.40.1'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"silent"},{"type":"Punctuator","value":":"},{"type":"Boolean","value":"true"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"numberOfRetries"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to install appium'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Most common reason is npm registry connectivity, try again'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"cp"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`${"},{"type":"Identifier","value":"SCRIPTS"},{"type":"Template","value":"}/android-e2e-test.js`"},{"type":"Punctuator","value":","},{"type":"String","value":"'android-e2e-test.js'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"String","value":"'android'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Downloading Maven deps'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'./gradlew :app:copyDownloadableDepsToLibs'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"String","value":"'..'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'rm android/app/debug.keystore'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'keytool -genkey -v -keystore android/app/debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname \"CN=Android Debug,O=Android,C=US\"'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Key could not be generated'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`Starting appium server, ${"},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"appiumProcess"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"spawn"},{"type":"Punctuator","value":"("},{"type":"String","value":"'node'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"["},{"type":"String","value":"'./node_modules/.bin/appium'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"appiumProcess"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"pid"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Building the app'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'react-native run-android'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'could not execute react-native run-android'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`Starting packager server, ${"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"packagerProcess"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"spawn"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yarn'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"["},{"type":"String","value":"'start'"},{"type":"Punctuator","value":","},{"type":"String","value":"'--max-workers 1'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"env"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"process"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"env"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"packagerProcess"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"pid"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sleep 15s'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Executing android end-to-end test'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"tryExecNTimes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sleep 10s'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'node node_modules/.bin/_mocha android-e2e-test.js'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"numberOfRetries"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to run Android end-to-end tests'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Most likely the code is broken'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"ios"},{"type":"Punctuator","value":"||"},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"tvos"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"checkMarker"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"var"},{"type":"Identifier","value":"iosTestType"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"tvos"},{"type":"Punctuator","value":"?"},{"type":"String","value":"'tvOS'"},{"type":"Punctuator","value":":"},{"type":"String","value":"'iOS'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Running the '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"iosTestType"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' app'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"String","value":"'ios'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"packagerEnv"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"Object"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"create"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"process"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"env"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"packagerEnv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"REACT_NATIVE_MAX_WORKERS"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"const"},{"type":"Identifier","value":"packagerProcess"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"spawn"},{"type":"Punctuator","value":"("},{"type":"String","value":"'yarn'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"["},{"type":"String","value":"'start'"},{"type":"Punctuator","value":","},{"type":"String","value":"'--nonPersistent'"},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"stdio"},{"type":"Punctuator","value":":"},{"type":"String","value":"'inherit'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"env"},{"type":"Punctuator","value":":"},{"type":"Identifier","value":"packagerEnv"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Punctuator","value":"="},{"type":"Identifier","value":"packagerProcess"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"pid"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sleep 15s'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'response=$(curl --write-out %{http_code} --silent --output /dev/null localhost:8081/index.bundle?platform=ios&dev=true)'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`Starting packager server, ${"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Running pod install'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'pod install'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Executing '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"iosTestType"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' end-to-end test'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"tryExecNTimes"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"=>"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'sleep 10s'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"destination"},{"type":"Punctuator","value":"="},{"type":"String","value":"'platform=iOS Simulator,name=iPhone 5s,OS=12.1'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"sdk"},{"type":"Punctuator","value":"="},{"type":"String","value":"'iphonesimulator'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"let"},{"type":"Identifier","value":"scheme"},{"type":"Punctuator","value":"="},{"type":"String","value":"'EndToEndTest'"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"tvos"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"destination"},{"type":"Punctuator","value":"="},{"type":"String","value":"'platform=tvOS Simulator,name=Apple TV,OS=11.4'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"sdk"},{"type":"Punctuator","value":"="},{"type":"String","value":"'appletvsimulator'"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"scheme"},{"type":"Punctuator","value":"="},{"type":"String","value":"'EndToEndTest-tvOS'"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"return"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":"["},{"type":"String","value":"'xcodebuild'"},{"type":"Punctuator","value":","},{"type":"String","value":"'-workspace'"},{"type":"Punctuator","value":","},{"type":"String","value":"'\"EndToEndTest.xcworkspace\"'"},{"type":"Punctuator","value":","},{"type":"String","value":"'-destination'"},{"type":"Punctuator","value":","},{"type":"Template","value":"`\"${"},{"type":"Identifier","value":"destination"},{"type":"Template","value":"}\"`"},{"type":"Punctuator","value":","},{"type":"String","value":"'-scheme'"},{"type":"Punctuator","value":","},{"type":"Template","value":"`\"${"},{"type":"Identifier","value":"scheme"},{"type":"Template","value":"}\"`"},{"type":"Punctuator","value":","},{"type":"String","value":"'-sdk'"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"sdk"},{"type":"Punctuator","value":","},{"type":"String","value":"'-UseModernBuildSystem=NO'"},{"type":"Punctuator","value":","},{"type":"String","value":"'test'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"String","value":"' '"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' | '"},{"type":"Punctuator","value":"+"},{"type":"Punctuator","value":"["},{"type":"String","value":"'xcpretty'"},{"type":"Punctuator","value":","},{"type":"String","value":"'--report'"},{"type":"Punctuator","value":","},{"type":"String","value":"'junit'"},{"type":"Punctuator","value":","},{"type":"String","value":"'--output'"},{"type":"Punctuator","value":","},{"type":"Template","value":"`\"~/react-native/reports/junit/${"},{"type":"Identifier","value":"iosTestType"},{"type":"Template","value":"}-e2e/results.xml\"`"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":"]"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"join"},{"type":"Punctuator","value":"("},{"type":"String","value":"' '"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' && exit ${PIPESTATUS[0]}'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":","},{"type":"Identifier","value":"numberOfRetries"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Failed to run '"},{"type":"Punctuator","value":"+"},{"type":"Identifier","value":"iosTestType"},{"type":"Punctuator","value":"+"},{"type":"String","value":"' end-to-end tests'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Most likely the code is broken'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"String","value":"'..'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"argv"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"js"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"checkMarker"},{"type":"Punctuator","value":"("},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'react-native bundle --max-workers 1 --platform android --dev true --entry-file index.js --bundle-output android-bundle.js'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Could not build Android bundle'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"'react-native --max-workers 1 bundle --platform ios --dev true --entry-file index.js --bundle-output ios-bundle.js'"},{"type":"Punctuator","value":","},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"."},{"type":"Identifier","value":"code"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"String","value":"'Could not build iOS bundle'"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"1"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"throw"},{"type":"Identifier","value":"Error"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":"="},{"type":"Numeric","value":"0"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"finally"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"cd"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"ROOT"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"rm"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"MARKER"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"SERVER_PID"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`Killing packager ${"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`kill -9 ${"},{"type":"Identifier","value":"SERVER_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"String","value":"\"lsof -i tcp:8081 | awk 'NR!=1 {print $2}' | xargs kill\""},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Keyword","value":"if"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":"{"},{"type":"Identifier","value":"echo"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`Killing appium ${"},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Identifier","value":"exec"},{"type":"Punctuator","value":"("},{"type":"Template","value":"`kill -9 ${"},{"type":"Identifier","value":"APPIUM_PID"},{"type":"Template","value":"}`"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"},{"type":"Punctuator","value":"}"},{"type":"Punctuator","value":"}"},{"type":"Identifier","value":"exit"},{"type":"Punctuator","value":"("},{"type":"Identifier","value":"exitCode"},{"type":"Punctuator","value":")"},{"type":"Punctuator","value":";"}]